# The Common Western Music Notation Recognition Evaluation Framework (COMREF)

This repository is a collection of tools that allow interaction with the MTN format, a representation of western music scores designed with the following key features in mind:

- **Presentation before semantics**: The format tries very hard not to make any assumptions about how the score has to be played, but rather how the score is laid out on paper.
- **Unique representation**: Any score can only be represented one way. This allows for direct comparison of scores.
- **Source-independent**: The format makes no assumptions about the origin of the predicted scores. Object detection or sequence-based methods can be targeted with this system. We are planning on adding a bounding-box extension by default.

This project is the code associated with the article **A Unified Representation Framework for the Evaluation of Optical Music Recognition Systems**, accepted for publication in the IJDAR-ICDAR track of 2024. If you find it useful, do not hesitate to cite the paper.

```bibtex
@article{torras2024unified,
  author  = {Torras, Pau AND Biswas, Sanket AND Fornes, Alicia},
  title   = {A Unified Representation Framework for the Evaluation of Optical Music Recognition Systems},
  journal = {International Journal of Document Analysis and Recognition},
  year    = {2024},
  volume  = {<TBA>},
  number  = {<TBA>},
  pages   = {<TBA>}
}
```

## Dataset

The accompanying dataset can be downloaded from [here](https://datasets.cvc.uab.cat/comref/comref.zip).

## Getting started

The project is distributed as a Python package. Clone the repository and install by running `pip setup <path to cloned repo>`. It has very few dependencies that pip should manage for you. If there are any issues, find the dependencies of the project in the [requirements.txt](./requirements.txt) file of this repository.

To convert scores to MTN, it is as simple as going into the `src` dir and running:

```
python3 convert.py <SOURCE PATH .{mxl|mtn|seq|mei}> <TARGET PATH .{mxl|mtn|seq|mei|dot|apt}>
```

Currently, conversion from MTN to MXL is still not supported.

To run evaluation tasks for scores in MTN, use the `evaluation.py` script. It can be run both using independent files as input or lists of files. For a single file, run:

```
python3 evaluate.py --predictions <FILE> --targets <FILE>
```

If more than one file is required, add them as a list 

```
python3 evaluate.py --predictions <FILE1> <FILE2> <FILE3> ... --targets <FILE>
```

Run `python3 convert.py --help` or `python3 evaluate.py --help` for more details regarding these scripts.

## Documentation

The wiki contains all of the Documentation for the project (work in progress).

## Known Issues

Check the issues section on the repository to find known bugs and issues.

## Roadmap

Future directions for this format entail the following steps

- [ ] Incorporating export to MusicXML features. *Currently the seeds are planted, but we need to find a good algorithm to ensure that the main voicing is contiguous (or insert enough invisible padding).*
- [ ] MEI import/export. *Currently this is not a priority because of the complexity of the task, but it could be done eventually if there is adoption.*
- [ ] Incorporating bounding boxes. *The extension is planned and partly implemented, but we have no data to put yet. We could use the bounding boxes generated by Verovio, but they do not quite match all primitives in the notation. Thus, we are exploring alternatives.*

## License

This project is licensed under the GNU GENERAL PUBLIC LICENSE version 3. Check the COPYING file for the full license text.

